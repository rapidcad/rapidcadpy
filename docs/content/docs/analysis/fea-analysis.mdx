---
title: Finite Element Analysis (FEA)
description: Perform structural analysis on your CAD models with integrated FEA
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Tab, Tabs } from 'fumadocs-ui/components/tabs';
import { Step, Steps } from 'fumadocs-ui/components/steps';

# Finite Element Analysis (FEA)

RapidCAD-Py includes integrated Finite Element Analysis powered by **torch-fem**, enabling you to validate your designs with structural analysis directly in Python.

<Callout type="info">
FEA requires additional dependencies. Install with: `pip install -e ".[fea]"`
</Callout>

## Quick Start

Here's a complete example of creating a model and analyzing it:

```python
from rapidcadpy.integrations.occ import OpenCascadeApp
from rapidcadpy.fea import Material, FixedConstraint, DistributedLoad

# Create geometry
app = OpenCascadeApp()
wp = app.work_plane("XY")
beam = wp.rect(10, 100).extrude(10)

# Run FEA analysis
results = app.fea(
    material=Material.STEEL,
    mesh_size=2.0,
    constraints=[
        FixedConstraint(location="x_min"),
    ],
    loads=[
        DistributedLoad(location="z_max", force=-1000.0, direction="z"),
    ],
)

# View results
print(f"Max stress: {results.max_stress:.2f} MPa")
print(f"Safety factor: {results.safety_factor():.2f}")
results.show(display='both')
```

## FEA Workflow

<Steps>

### Create Your Model

Start by creating a parametric CAD model using the fluent API:

```python
from rapidcadpy.integrations.occ import OpenCascadeApp

app = OpenCascadeApp()
wp = app.work_plane("XY")

# Create a cantilever beam
beam = wp.rect(width=10, height=100).extrude(thickness=10)
```

### Define Material Properties

Choose from pre-defined materials or create custom ones:

<Tabs items={['Pre-defined Materials', 'Custom Material']}>
  <Tab value="Pre-defined Materials">
    ```python
    from rapidcadpy.fea import Material
    
    # Use built-in materials
    material = Material.STEEL              # Structural steel
    material = Material.ALUMINUM_6061      # Aluminum alloy
    material = Material.TITANIUM_GRADE_5   # Titanium
    material = Material.STAINLESS_STEEL_304
    material = Material.CARBON_FIBER
    ```
  </Tab>
  
  <Tab value="Custom Material">
    ```python
    from rapidcadpy.fea import MaterialProperties
    
    # Define custom material
    material = MaterialProperties(
        name="Custom Alloy",
        E=200000.0,              # Young's modulus (MPa)
        nu=0.3,                  # Poisson's ratio
        density=7.85,            # Density (g/cmÂ³)
        yield_strength=250.0,    # Yield strength (MPa)
        ultimate_strength=400.0  # Ultimate strength (MPa)
    )
    ```
  </Tab>
</Tabs>

### Define Constraints and Loads

Constraints prevent movement (like supports), while loads apply forces to the model. These are specified separately in the `fea()` method:

```python
from rapidcadpy.fea import (
    FixedConstraint, 
    DistributedLoad, 
    PointLoad
)

# Constraints - prevent movement at supports
constraints = [
    FixedConstraint(location='x_min'),  # Fix one end of the beam
]

# Loads - apply forces to the model
loads = [
    DistributedLoad(
        location='z_max',
        force=-1000.0,        # Total force in Newtons
        direction='z'         # Direction
    ),
    # Optional: Add point load
    PointLoad(
        point=(5, 50, 10),    # (x, y, z) coordinates
        force=(0, 0, -500),   # Force vector (Fx, Fy, Fz)
    )
]
```

### Run Analysis

Execute the FEA solver with separate constraints and loads:

```python
results = app.fea(
    material=Material.STEEL,
    mesh_size=2.0,                    # Mesh element size (mm)
    constraints=constraints,
    loads=loads,
)
```

### Analyze Results

Access results and check safety:

```python
# Get key metrics
max_disp = results.max_displacement  # mm
max_stress = results.max_stress      # MPa
mean_stress = results.mean_stress    # MPa

# Calculate safety factor
safety_factor = results.safety_factor()

# Print summary
print(results.summary())

# Visualize
results.show(display='both')         # Stress + displacement
results.show(display='conditions')    # Boundary conditions
```

</Steps>

## Materials Library

RapidCAD-Py includes a library of common engineering materials:

| Material | Young's Modulus (GPa) | Density (g/cmÂ³) | Yield Strength (MPa) |
|----------|----------------------|-----------------|---------------------|
| `Material.STEEL` | 210 | 7.85 | 250 |
| `Material.ALUMINUM_6061` | 69 | 2.70 | 276 |
| `Material.ALUMINUM_7075` | 72 | 2.81 | 503 |
| `Material.TITANIUM_GRADE_5` | 114 | 4.43 | 880 |
| `Material.STAINLESS_STEEL_304` | 193 | 8.00 | 215 |
| `Material.CARBON_FIBER` | 230 | 1.60 | 600 |
| `Material.BRASS` | 100 | 8.40 | 200 |
| `Material.COPPER` | 120 | 8.96 | 70 |

### Using Materials

```python
from rapidcadpy.fea import Material

# Direct usage
results = beam.analyze(material=Material.STEEL, ...)

# By string name
results = beam.analyze(material="steel", ...)

# Access material properties
mat = Material.ALUMINUM_6061
print(f"E = {mat.E} MPa")
print(f"Density = {mat.density} g/cmÂ³")
```

## Constraints and Loads

In RapidCAD-Py FEA, boundary conditions are separated into two categories:
- **Constraints** - Define supports that prevent movement (passed to the `constraints` parameter)
- **Loads** - Define forces applied to the model (passed to the `loads` parameter)

This separation makes your analysis setup clearer and more maintainable.

### Constraints (Supports)

Constraints prevent movement in specified directions:

#### FixedConstraint

Prevents all movement (translations and rotations):

```python
from rapidcadpy.fea import FixedConstraint

# Fix entire surface
FixedConstraint(location='x_min')       # Fix surface at x minimum
FixedConstraint(location='y_max')       # Fix surface at y maximum
FixedConstraint(location='bottom')      # Fix bottom surface (z_min)

# Fix specific point
FixedConstraint(location=(10, 50, 0))   # Fix point at coordinates

# Partial constraint (specific DOFs)
FixedConstraint(
    location='x_min',
    dofs=(True, True, False)  # Fix X and Y, allow Z movement
)
```

#### PinnedConstraint

Prevents translation but allows rotation:

```python
from rapidcadpy.fea import PinnedConstraint

PinnedConstraint(location='x_min')
```

#### RollerConstraint

Restricts movement in one direction only:

```python
from rapidcadpy.fea import RollerConstraint

RollerConstraint(
    location='bottom',
    direction='z'  # Only prevent Z movement
)
```

### Loads (Forces)

Loads apply forces to the model:

#### DistributedLoad

Force distributed evenly over a surface:

```python
from rapidcadpy.fea import DistributedLoad

# Scalar force (auto-determines direction from surface)
DistributedLoad(
    location='top',
    force=-1000.0  # Negative = downward for top surface
)

# With explicit direction
DistributedLoad(
    location='top',
    force=-1000.0,
    direction='z'  # Force in Z direction
)

# Vector force
DistributedLoad(
    location='x_max',
    force=(100, 0, -500)  # (Fx, Fy, Fz) in Newtons
)
```

#### PointLoad

Concentrated force at a specific location:

```python
from rapidcadpy.fea import PointLoad

# Scalar force
PointLoad(
    point=(5, 50, 10),
    force=-500.0,
    direction='z'
)

# Vector force
PointLoad(
    point=(5, 50, 10),
    force=(0, 0, -500)  # (Fx, Fy, Fz)
)
```

#### PressureLoad

Pressure applied to a surface:

```python
from rapidcadpy.fea import PressureLoad

PressureLoad(
    location='top',
    pressure=-10.0  # MPa (negative for compression)
)
```

### Location Identifiers

Boundary conditions support these location identifiers:

- `'x_min'` / `'end_1'` - Surface at minimum X
- `'x_max'` / `'end_2'` - Surface at maximum X
- `'y_min'` - Surface at minimum Y
- `'y_max'` - Surface at maximum Y
- `'z_min'` / `'bottom'` - Surface at minimum Z
- `'z_max'` / `'top'` - Surface at maximum Z
- `(x, y, z)` - Specific point coordinates

## Results Analysis

### FEAResults Object

The `analyze()` method returns an `FEAResults` object with comprehensive data:

```python
results = beam.analyze(...)

# Properties
results.max_displacement      # Maximum displacement (mm)
results.max_stress           # Maximum von Mises stress (MPa)
results.min_stress           # Minimum stress (MPa)
results.mean_stress          # Average stress (MPa)

# Mesh information
results.nodes                # Node coordinates tensor
results.elements             # Element connectivity tensor
results.mesh_size            # Mesh element size
results.element_type         # Element type (tet4, hex8, etc.)

# Solution data
results.displacement         # Nodal displacement tensor
results.stress              # Element stress tensor
results.von_mises_stress    # Von Mises stress tensor

# Geometry
results.bounding_box        # Model bounds
results.volume              # Volume (mmÂ³)
results.mass                # Mass (kg)

# Material
results.material            # Material properties used
```

### Safety Analysis

```python
# Calculate factor of safety
fos = results.safety_factor()

# With custom yield strength
fos = results.safety_factor(yield_strength=300.0)

# Make design decisions
if fos > 2.0:
    print("âœ“ Design is safe with 2x safety margin")
    beam.export("approved_design.step")
elif fos > 1.0:
    print("âš  Design is marginal, consider strengthening")
else:
    print("âœ— Design failure predicted, redesign required")
```

### Text Summary

```python
# Generate comprehensive report
print(results.summary())
```

Output:
```
================================================================================
FEA ANALYSIS RESULTS SUMMARY
================================================================================

Material: Structural Steel
  E = 210,000 MPa
  Î½ = 0.3
  Density = 7.85 g/cmÂ³

Mesh:
  Nodes: 1,234
  Elements: 5,678
  Element type: tet4
  Mesh size: 2.0 mm

Geometry:
  Volume: 10000.00 mmÂ³
  Mass: 0.0785 kg (78.50 g)

Results:
  Max displacement: 1.234e-02 mm
  Max von Mises stress: 45.67 MPa
  Mean von Mises stress: 23.45 MPa

Safety Analysis:
  Yield strength: 250 MPa
  Factor of safety: 5.47
  Status: SAFE
================================================================================
```

## Visualization

### Interactive Visualization

```python
# Display modes
results.show(display='stress')          # Von Mises stress
results.show(display='displacement')    # Deformation (scaled)
results.show(display='both')            # Side-by-side (default)
results.show(display='conditions')      # Boundary conditions

# Customize
results.show(
    display='displacement',
    displacement_scale=10.0,   # Exaggerate deformation
    window_size=(1920, 1080)   # Custom window size
)
```

![FEA Results - Stress and Displacement](display_both_example.png)

### Boundary Condition Visualization

Visualize constraints and loads before solving:

```python
from rapidcadpy.fea import visualize_boundary_conditions

# After setting up model with boundary conditions
visualize_boundary_conditions(model, nodes, elements)
```

Shows:
- ðŸ”´ **Red spheres** - Fixed/constrained nodes
- ðŸŸ¢ **Green spheres** - Loaded nodes
- âž¡ï¸ **Green arrows** - Force direction and magnitude

### Export Results

```python
# Save screenshot
results.save_report('analysis_results.png')

# Export to VTK for ParaView
results.to_vtk('results.vtk')

# For Jupyter notebooks
results.show(display='both', jupyter_backend='static')
```

## Complete Examples

### Cantilever Beam

```python
from rapidcadpy.integrations.occ import OpenCascadeApp
from rapidcadpy.fea import Material, FixedConstraint, DistributedLoad

# Create beam
app = OpenCascadeApp()
wp = app.work_plane("XY")
beam = wp.rect(10, 100).extrude(10)

# Analyze with separate constraints and loads
results = app.fea(
    material=Material.STEEL,
    mesh_size=2.0,
    constraints=[
        FixedConstraint(location="x_min"),
    ],
    loads=[
        DistributedLoad(location="z_max", force=-1000.0, direction="z"),
    ],
)

# Check results
print(f"Max deflection: {results.max_displacement:.4f} mm")
print(f"Max stress: {results.max_stress:.2f} MPa")
print(f"Safety factor: {results.safety_factor():.2f}")

results.show(display='both')
```

### Parametric Optimization

```python
import numpy as np
from rapidcadpy.integrations.occ import OpenCascadeApp
from rapidcadpy.fea import Material, FixedConstraint, DistributedLoad

def analyze_beam(width, height):
    """Analyze beam with given dimensions"""
    app = OpenCascadeApp()
    wp = app.work_plane("XY")
    beam = wp.rect(width, height).extrude(10)
    
    results = app.fea(
        material=Material.ALUMINUM_6061,
        mesh_size=2.0,
        constraints=[
            FixedConstraint(location="x_min"),
        ],
        loads=[
            DistributedLoad(location="z_max", force=-1000.0, direction="z"),
        ],
    )
    
    return {
        'width': width,
        'height': height,
        'mass': results.mass,
        'max_stress': results.max_stress,
        'safety_factor': results.safety_factor()
    }

# Test different dimensions
dimensions = [(5, 50), (10, 100), (15, 150)]
results = [analyze_beam(w, h) for w, h in dimensions]

# Find optimal design
valid_designs = [r for r in results if r['safety_factor'] > 2.0]
optimal = min(valid_designs, key=lambda x: x['mass'])

print(f"Optimal design: {optimal['width']}x{optimal['height']} mm")
print(f"Mass: {optimal['mass']*1000:.2f} g")
print(f"Safety factor: {optimal['safety_factor']:.2f}")
```

### Bridge Structure

```python
from rapidcadpy.integrations.occ import OpenCascadeApp
from rapidcadpy.fea import Material, FixedConstraint, DistributedLoad

app = OpenCascadeApp()
wp = app.work_plane("XY")

# Create bridge deck
deck = wp.rect(20, 100).extrude(2)

# Add support beams
support1 = wp.move_to(0, 0).rect(20, 5).extrude(10)
support2 = wp.move_to(0, 95).rect(20, 5).extrude(10)

# Combine
bridge = deck.join(support1).join(support2)

# Analyze with traffic load - separate constraints and loads
results = app.fea(
    material=Material.STEEL,
    mesh_size=3.0,
    constraints=[
        FixedConstraint(location="y_min"),      # Fix one end
        FixedConstraint(location="y_max"),      # Fix other end
    ],
    loads=[
        DistributedLoad(                        # Traffic load
            location="z_max",
            force=-5000.0,
            direction="z"
        ),
    ],
)

# Validate design
if results.safety_factor() > 3.0:  # Higher safety for public structures
    print("âœ“ Bridge design approved")
    bridge.export("bridge_approved.step")
    results.save_report("bridge_analysis.png")
else:
    print("âœ— Bridge needs reinforcement")
```

## Advanced Topics

### Mesh Control

```python
# Finer mesh for more accurate results
results = app.fea(
    material=Material.STEEL,
    mesh_size=1.0,  # Smaller = more elements, slower but more accurate
    constraints=[...],
    loads=[...],
)

# Element types
# 'tet4'  - 4-node linear tetrahedron (default, fast)
# 'tet10' - 10-node quadratic tetrahedron (more accurate)
# 'hex8'  - 8-node linear hexahedron
# 'hex20' - 20-node quadratic hexahedron
```

### Custom Tolerance

```python
# Adjust tolerance for node selection
FixedConstraint(
    location='x_min',
    tolerance=0.5  # mm (default: 0.1)
)
```

### App-Level Analysis

Analyze entire assemblies:

```python
from rapidcadpy.integrations.occ import OpenCascadeApp
from rapidcadpy.fea import Material, FixedConstraint, DistributedLoad

app = OpenCascadeApp()
wp = app.work_plane("XY")

# Create multiple parts
part1 = wp.rect(10, 50).extrude(10)
part2 = wp.move_to(0, 50).rect(10, 50).extrude(10)

# Analyze entire assembly with separate constraints and loads
results = app.fea(
    material=Material.STEEL,
    mesh_size=2.0,
    constraints=[
        FixedConstraint(location="x_min"),
    ],
    loads=[
        DistributedLoad(location="z_max", force=-1000.0, direction="z"),
    ],
)
```

## Troubleshooting

### Common Issues

**"No nodes found at location"**
- Increase `tolerance` parameter
- Verify location identifier matches your geometry
- Use `results.bounding_box` to check geometry bounds

**"mesh_size too large"**
- Reduce `mesh_size` for finer mesh
- Very small parts need smaller mesh sizes

**"Singular matrix / solver failed"**
- Check that constraints properly support the model
- Ensure loads are applied correctly
- Verify geometry is valid (no zero-thickness parts)

**"ImportError: FEA dependencies not available"**
- Install FEA support: `pip install -e ".[fea]"`

### Best Practices

1. **Start with coarser mesh** (`mesh_size=5.0`) for quick iterations
2. **Refine mesh** (`mesh_size=1.0`) for final validation
3. **Always check safety factor** before trusting results
4. **Visualize boundary conditions** first to verify setup
5. **Use appropriate safety factors** (typically 2.0-3.0 for structures)
6. **Validate with hand calculations** for simple cases

## API Reference

See the [Python API Reference](/docs/python) for detailed class and method documentation.

## Next Steps

- Explore [example scripts](https://github.com/rapidcad/rapidcadpy/tree/main/examples/fea)
- Learn about [parametric modeling](/docs/fluent-api)
- Understand [workplanes](/docs/workplanes)
